{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load thumbnail %}
{% load cloudinary %}
{% block style %}
<link href ="{% static "tournaments_calculating/css/style.css" %}" rel = "stylesheet">
{% endblock %}
{% block content %}
<div class="list-group">
    <ol>
        <br class="list-group-item">
        {% if tournament.user == request.user %}
        {% if not rounds %}
        <button id="delete_tournament" type="button" style="background-color:red"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournament_calculating:delete_group' group_id tournament.id %}">
                Usuń grupę
            </a>
        </button>
        {% endif %}
        {% endif %}
        <h5>
            grupa {{  number }} turnieju:
            <a style="text-decoration: none;" href = "{% url 'tournaments:tournament_details' tournament.id %}" >
                {{  tournament.title }}
            </a>
            {% if image %}
            {% thumbnail tournament.image "100x100" as im %}
            <img src="{{ im.url }}" alt="zdj">
            {% endthumbnail %}
            {% endif %}
            {% for organizer in tournament.organizers.all%}
            {{ organizer }}
            {% endfor %}
        </h5>
        {% if tournament.user == request.user %}
        {% if not rounds %}
        <button id="delete_tournament" type="button" style="background-color:lightseagreen "  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournaments:add_participant' tournament.id group_id%}">
                Dodaj uczestnika
            </a>
            <a style="color:white; text-decoration: none;" href = "{% url 'tournaments:add_participant' tournament.id group_id%}">
            </a>
        </button>
        <span id="delete_tournament" type="button" style="background-color:blueviolet"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournaments:create_participant' %}">
                Utwórz uczestnika
            </a>
        </span>
        {% endif %}
        {% if not rounds %}
        <button id="delete_tournament" type="button" style="background-color:plum"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournament_calculating:draw_fights' group_id %}">
                Losuj walki
            </a>
            {% endif %}
        </button>
        {% if not rounds %}
        <button id="delete_tournament" type="button" style="background-color:coral"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournament_calculating:delete_fights' group_id tournament.id   %}">
                Usuń walki
            </a>
        </button>
        {% endif %}
        {% if rounds %}
        <span id="delete_tournament" type="button" style="background-color:blueviolet"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournament_calculating:group_summary' group_id %}">
                podsumowanie grupy
            </a>
        </span>
        {% endif %}
        {% endif %}
    </div>
    <hr>
    {% if fighters_one_names %}
    <center>
        FAZA GRUPOWA
        {% if rounds %}
        ilość starć: {{ rounds }}
        {% else %}
        <span id="delete_tournament" type="button" style="background-color:orange"  class="btn btn-primary">
            <a style="color:white; text-decoration: none;" href = "{% url 'tournament_calculating:add_rounds' group_id %}">
                ile starć:
            </a>
        </span>
        dodaj ile starć ma mieć każda walka
        {% endif %}
    </center>
    <h5>
        walki grupa {{  number }} :
    </h5>
    <table  BORDER CELLSPACING=5 CELLPADDING=25><caption align="top"></caption>

        <tr>
            {% for fight in fights%}
            <td>
                {{ fight.order}}
            </td>
            {% endfor %}
        </tr>


        <tr >
            {% for fighter in fighters_one_names %}
            <td style=" background:  {{ group.color_fighter_one }}">
                <a style="text-decoration: none; color:black" href = "{% url 'tournament_calculating:participant_details' fighter.id %}" >
                    <b>
                        {{ fighter.name }}
                    </b>
                </a>
            </td>
            {% endfor %}
        </tr>


        <tr>
            {% for fighter in fighters_two_names  %}
            <td style=" background: {{ group.color_fighter_two }}">
                <a style="text-decoration: none; color:black" href = "{% url 'tournament_calculating:participant_details' fighter.id %}" >
                    <b>
                        {{ fighter.name }}
                    </b>
                    </a>
                </td>
                {% endfor %}
            </tr>



            {% for fight in fights %}

            <td style=" vertical-align:top ">
            {% for r in fight.rounds_of_fight.all|dictsort:"id" %}



                        {% if r.points_fighter_one %}
                        <a id="delete_tournament" class="btn btn-primary" style="color:black; background-color:oldlace; text-decoration: none;   " href = "{% url 'tournament_calculating:add_points' group_id fight.id r.id    %}">
                            <b>
                                {{ r.order }}
                                <br>
                                <span style=" color: black">
                                    {{ fight.fighter_one.name }}:
                                </span>
                            </b>
                            <b>
                                <span style=" color: black" >
                                    {% if r.points_fighter_one|floatformat %}
                                    {{ r.points_fighter_one|floatformat:"-2" }}
                                    {% else %}
                                    {{ r.points_fighter_one}}
                                    {% endif %}
                                </span>
                            </b>

                            {% endif %}




                            {% if r.points_fighter_one %}
                            <hr style="color: black">
                            <b>
                                <span style=" color: black">
                                    {{ fight.fighter_two.name }}:
                                </span>
                            </b>
                            <b>
                                <span style=" color: black">
                                    {% if r.points_fighter_two|floatformat %}
                                    {{ r.points_fighter_two|floatformat:"-2" }}
                                    {% else %}
                                    {{ r.points_fighter_two}}
                                    {% endif %}
                                </span>
                            </b>
                                 </a>
                            {% endif %}




                        <span style="background-color:{{ group.color_fighter_one }};" class="list-group-item list-group-item-light">
                            starcie {{ r.order }} {{ fight.fighter_one.name }}vvvvvvvvvvv
                            {% for status in ROUND_STATUS %}
                            <a  id="kotwica" style="color:white; text-decoration: none;" href="{% url 'tournament_calculating:add_points_fighter_one' group_id fight.id r.id %}?points={{ status.0 }}&fighter={{ r.fighter_one.id }}#kotwica">
                                <span style= "color: black; background-color: white;" type="button" class="btn btn-primary">
                                    {{ status.0 }}
                                </span>
                            </a>
                            {% endfor %}
                        </span>

                        <span style="background-color:{{ group.color_fighter_two }};" class="list-group-item list-group-item-light">
                            starcie {{ r.order }} {{ fight.fighter_two.name }}
                            {% for status in ROUND_STATUS %}
                            <a style="color:white; text-decoration: none;" href="{% url 'tournament_calculating:add_points_fighter_two' group_id fight.id r.id %}?points={{ status.0 }}&fighter={{ r.fighter_two.id }}">
                                <span style= "color: black; background-color: white;" type="button" class="btn btn-primary" >
                                    {{ status.0 }}
                                </span>
                            </a>
                            {% endfor %}
                        </span>




                    <br>
                    <br>
                    {% endfor %}






                    <br>
                    {{ fight.fighter_one.name }}:
                    {% if fight.fighter_one_points %}
                    <b>
                        {{ add_four_points_one  }}
                    </b>
                    {% endif %}
                    <br>
                    {{ fight.fighter_two.name }}:
                    {% if fight.fighter_two_points %}
                    <b>
                        {{ fight.fighter_two_points }}
                    </b>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    <tr>
                    </tr>
                </table>
                <style>
                    td, th { border: 1px solid black; }
                </style>
                <br>
                <table BORDER CELLSPACING=5 CELLPADDING=15 >
                    <thead>
                        <tr>
                            <h5>
                                punkty
                                <span style="color: saddlebrown">
                                    cząstkowe zsumowane
                                </span>
                                i
                                <span style="color: darkblue">
                                    wyjściowe
                                </span>
                                grupa {{  number }} ( średnia punktów w turnieju z odbytych walk -
                                <span style="color: crimson">
                                    {{ tournaments_fighters_average}}
                                </span>
                                )
                            </h5>
                        </tr>
                        <tr>
                            {% for group in groups %}
                            <th style="background: bisque">
                                grupa nr {{ group.number }}
                                {%  if group.id == group_id %}
                                (teraz jesteś)
                                {% endif %}
                                {% endfor %}
                            </th>
                        </tr>
                    </thead>
                    <tr>
                        {% for gr in groups %}
                        <td >
                            <table BORDER CELLSPACING=5 CELLPADDING=15  >
                                <tr>
                                    {% for participant in gr.participants.all %}
                                    {% for testgroup in participant.participantgroup_set.all %}
                                    {% if testgroup.tournament_id == tournament.id %}
                                    <td style="width:100%;table-layout:fixed;">
                                        {%  if group_id == testgroup.group_id %}
                                        {% endif %}
                                        <p>
                                            {{ testgroup.participant.name }} (rund {{ testgroup.tournament_amount_rounds }})
                                            <span style="color: saddlebrown">
                                                {{ testgroup.tournament_points }}
                                            </span>
                                            x
                                            <span style="color: #ba2121">
                                                {{ tournaments_fighters_average }}
                                            </span>
                                            =
                                            <span style="color: darkblue">
                                                {{ testgroup.tournament_points_modified }}
                                            </span>
                                        </p>
                                        {% endif %}
                                    </td>
                                    {% endfor %}
                                    {%  if gr.id == group_id %}
                                    <td style="background-color: plum">
                                    </td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
                            </table>
                            {% endfor %}
                        </tr>
                    </table>
                    <br>
                    uczestnicy:
                    {% for participant in group_participants|dictsortreversed:"tournament_average" %}
                    <ul>
                        <br>
                        <a style="text-decoration: none;" href = "{% url 'tournament_calculating:participant_details' participant.id %}" >
                                <b>
                                    {{  participant.participant.name }} z {{ participant.participant.school  }}
                                </b>
                                    {% if participant.participant.image %}
                                    {% thumbnail participant.participant.image "100x100" as im %}
                                    <img src="{{ im.url }}" alt="zdj">
                                    {% endthumbnail %}
                                    {% endif %}
                        </a>
                                {% if tournament.user == request.user %}
                                {% if not rounds %}
                                <a style="color:red;  column-count: 2;"   href = "{% url 'tournament_calculating:delete_group_participant' group_id tournament.id participant.participant.id%}" >
                                    usuń
                                </a>
                                {% endif %}
                                {% endif %}
                        </ul>
                        {% endfor %}

                        {% endblock %}